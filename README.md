# otus-devops-project
Repo for graduate work in otus in DevOps

GCP project = devops-254718

## Описание инфраструктуры
Инфраструктура состоит из нескольких контуров: infra, stage, prod. Последие 2 контура - контура для приложения, раворачивающего с помощью конвеера

### infra
Контур infra - это контур для общей инфраструктуры. Состоит из виртуальной машины с докером, внутри которой крутятся в контейнерах крутятся сервисы:
- Система контроля версий (gitlab)
- Конвеер развертывания (gitlab)
- Система мониторинга (prometheus, grafana)

### Stage и Prod
2 контура, предназначенных для работы приложения. Оба контура идентичны в плане инфраструктуры. Различия лишь в том, что в stage выкатывается тестовая версия приложения (например, с ветки develop), а в prod стабильная и рабочая версия с ветки master или release в зависимости от используемого gitflow (В проекте будет использован деплой с ветки master).
Каждый контур состоит из отдельной виртуальной машины с докером внутри. Виртуальные машины не должны иметь прямой доступ друг к другу. В контейнерах крутятся приложения (с необходимыми для их работы сервисами, такими как БД или очередь), а так же сопутствующие сервисы, необходимые для организации мониторинга, логирования или конвеера.


## Предварительная подготовка

### Packer
Версия пакера > 1.4.4
Можно использовать, как application default credentials (по умолчанию), так и указать путь к ключу для сервис аккаунта GCP (переменная account_file).

### Terraform
Версия > 0.12.0
Можно использовать как application default credentials (по умолчанию), так и указать путь к ключу для сервис аккауна GCP (переменная `gcp_key_path`).